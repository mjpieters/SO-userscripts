// ==UserScript==
// @name        Connected Users
// @description **Moderator-only**. Hightlights users in the IP cross section view that overlap in time
// @version     1.5.2
// @author      Martijn Pieters
// @homepage    https://github.com/mjpieters/SO-userscripts/tree/main/scripts/connected-users
// @supportURL  https://github.com/mjpieters/SO-userscripts/issues?q=is:issue+is%3Aopen+label:connected-users
// @match       *://stackoverflow.com/admin/xref-user-ips/*
// @match       *://serverfault.com/admin/xref-user-ips/*
// @match       *://superuser.com/admin/xref-user-ips/*
// @match       *://askubuntu.com/admin/xref-user-ips/*
// @match       *://mathoverflow.net/admin/xref-user-ips/*
// @match       *://stackapps.com/admin/xref-user-ips/*
// @match       *://*.stackexchange.com/admin/xref-user-ips/*
// @downloadURL https://github.com/mjpieters/SO-userscripts/releases/latest/download/connected-users.user.js
// @namespace   https://github.com/mjpieters/SO-userscripts
// @updateURL   https://github.com/mjpieters/SO-userscripts/releases/latest/download/connected-users.meta.js
// ==/UserScript==

(()=>{"use strict";var t="us-mod-connected-users";function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=new Promise((function(t){StackExchange.ready((function(){return t(null)}))})),o=function(t){return t.replace(/(?:[_-])([a-z0-9])/g,(function(t,e){return e.toUpperCase()}))},a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,"values",new Map),n(this,"maxEntries",20),void 0!==e&&(this.maxEntries=e)}var r,o;return r=t,(o=[{key:"get",value:function(t){var e=this.values.get(t);return void 0!==e&&(this.values.delete(t),this.values.set(t,e)),e}},{key:"put",value:function(t,e){for(;this.values.size>=this.maxEntries;)this.values.delete(this.values.keys().next().value);this.values.set(t,e)}}])&&e(r.prototype,o),t}();const i='<svg aria-hidden="true" class="svg-icon iconEyeOffSm" width="14" height="14"  viewBox="0 0 14 14"><path  d="M3.52 7.38 1.58 9.26A12.38 12.38 0 0 1 0 7s2.63-5.14 7.05-5.14c.66 0 1.28.12 1.86.32L7.44 3.6a3.48 3.48 0 0 0-3.92 3.78ZM5.3 9.99c.5.28 1.1.44 1.71.44 1.94 0 3.5-1.53 3.5-3.43 0-.62-.17-1.21-.47-1.72L8.7 6.6a1.73 1.73 0 0 1-2.08 2.07L5.29 10Zm6.23-6.19A12.7 12.7 0 0 1 14 7s-2.63 5.14-6.95 5.14A6.1 6.1 0 0 1 4 11.3L2.27 13l-1.4-1.36L11.9 1l1.23 1.2-1.6 1.6Z"/></svg>',s='<svg aria-hidden="true" class="svg-icon iconEyeSm" width="14" height="14"  viewBox="0 0 14 14"><path  d="M7.05 2C2.63 2 0 7.5 0 7.5S2.63 13 7.05 13C11.38 13 14 7.5 14 7.5S11.37 2 7.05 2ZM7 11.17A3.59 3.59 0 0 1 3.5 7.5 3.6 3.6 0 0 1 7 3.83c1.94 0 3.5 1.65 3.5 3.67A3.57 3.57 0 0 1 7 11.17Zm0-1.84c.97 0 1.75-.81 1.75-1.83S7.97 5.67 7 5.67s-1.75.81-1.75 1.83S6.03 9.33 7 9.33Z"/></svg>';function c(t){return t.replace(/(?:[_-])([a-z0-9])/g,((t,e)=>e.toUpperCase()))}function u(t){return t.charAt(0).toUpperCase()+t.slice(1)}function l(t,e){const n=f(t);return Array.from(n.reduce(((t,n)=>(function(t,e){const n=t[e];return Array.isArray(n)?n:[]}(n,e).forEach((e=>t.add(e))),t)),new Set))}function f(t){const e=[];for(;t;)e.push(t),t=Object.getPrototypeOf(t);return e.reverse()}function d(t){return t.reduce(((t,[e,n])=>Object.assign(Object.assign({},t),{[e]:n})),{})}function h([t,e],n){return function(t){const e=`${r=t.token,r.replace(/([A-Z])/g,((t,e)=>`-${e.toLowerCase()}`))}-value`,n=function(t){const e=function(t){const e=p(t.typeObject.type);if(!e)return;const n=y(t.typeObject.default);if(e!==n){throw new Error(`The specified default value for the Stimulus Value "${t.controller?`${t.controller}.${t.token}`:t.token}" must match the defined type "${e}". The provided default value of "${t.typeObject.default}" is of type "${n}".`)}return e}({controller:t.controller,token:t.token,typeObject:t.typeDefinition}),n=y(t.typeDefinition),r=p(t.typeDefinition),o=e||n||r;if(o)return o;throw new Error(`Unknown value type "${t.controller?`${t.controller}.${t.typeDefinition}`:t.token}" for "${t.token}" value`)}(t);var r;return{type:n,key:e,name:c(e),get defaultValue(){return function(t){const e=p(t);if(e)return v[e];const n=t.default;return void 0!==n?n:t}(t.typeDefinition)},get hasCustomDefaultValue(){return void 0!==y(t.typeDefinition)},reader:b[n],writer:g[n]||g.default}}({controller:n,token:t,typeDefinition:e})}function p(t){switch(t){case Array:return"array";case Boolean:return"boolean";case Number:return"number";case Object:return"object";case String:return"string"}}function y(t){switch(typeof t){case"boolean":return"boolean";case"number":return"number";case"string":return"string"}return Array.isArray(t)?"array":"[object Object]"===Object.prototype.toString.call(t)?"object":void 0}"function"==typeof Object.getOwnPropertySymbols||Object.getOwnPropertyNames,(()=>{function t(t){function e(){return Reflect.construct(t,arguments,new.target)}return e.prototype=Object.create(t.prototype,{constructor:{value:e}}),Reflect.setPrototypeOf(e,t),e}try{return function(){const e=t((function(){this.a.call(this)}));e.prototype.a=function(){},new e}(),t}catch(t){return t=>class extends t{}}})(),Object.assign(Object.assign({enter:"Enter",tab:"Tab",esc:"Escape",space:" ",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",home:"Home",end:"End"},d("abcdefghijklmnopqrstuvwxyz".split("").map((t=>[t,t])))),d("0123456789".split("").map((t=>[t,t]))));const v={get array(){return[]},boolean:!1,number:0,get object(){return{}},string:""},b={array(t){const e=JSON.parse(t);if(!Array.isArray(e))throw new TypeError(`expected value of type "array" but instead got value "${t}" of type "${y(e)}"`);return e},boolean:t=>!("0"==t||"false"==String(t).toLowerCase()),number:t=>Number(t),object(t){const e=JSON.parse(t);if(null===e||"object"!=typeof e||Array.isArray(e))throw new TypeError(`expected value of type "object" but instead got value "${t}" of type "${y(e)}"`);return e},string:t=>t},g={default:function(t){return`${t}`},array:m,object:m};function m(t){return JSON.stringify(t)}class w{constructor(t){this.context=t}static get shouldLoad(){return!0}static afterLoad(t,e){}get application(){return this.context.application}get scope(){return this.context.scope}get element(){return this.scope.element}get identifier(){return this.scope.identifier}get targets(){return this.scope.targets}get outlets(){return this.scope.outlets}get classes(){return this.scope.classes}get data(){return this.scope.data}initialize(){}connect(){}disconnect(){}dispatch(t,{target:e=this.element,detail:n={},prefix:r=this.identifier,bubbles:o=!0,cancelable:a=!0}={}){const i=new CustomEvent(r?`${r}:${t}`:t,{detail:n,bubbles:o,cancelable:a});return e.dispatchEvent(i),i}}w.blessings=[function(t){return l(t,"classes").reduce(((t,e)=>{return Object.assign(t,{[`${n=e}Class`]:{get(){const{classes:t}=this;if(t.has(n))return t.get(n);{const e=t.getAttributeName(n);throw new Error(`Missing attribute "${e}"`)}}},[`${n}Classes`]:{get(){return this.classes.getAll(n)}},[`has${u(n)}Class`]:{get(){return this.classes.has(n)}}});var n}),{})},function(t){return l(t,"targets").reduce(((t,e)=>{return Object.assign(t,{[`${n=e}Target`]:{get(){const t=this.targets.find(n);if(t)return t;throw new Error(`Missing target element "${n}" for "${this.identifier}" controller`)}},[`${n}Targets`]:{get(){return this.targets.findAll(n)}},[`has${u(n)}Target`]:{get(){return this.targets.has(n)}}});var n}),{})},function(t){const e=function(t,e){return f(t).reduce(((t,n)=>(t.push(...function(t,e){const n=t[e];return n?Object.keys(n).map((t=>[t,n[t]])):[]}(n,e)),t)),[])}(t,"values"),n={valueDescriptorMap:{get(){return e.reduce(((t,e)=>{const n=h(e,this.identifier),r=this.data.getAttributeNameForKey(n.key);return Object.assign(t,{[r]:n})}),{})}}};return e.reduce(((t,e)=>Object.assign(t,function(t,e){const n=h(t,void 0),{key:r,name:o,reader:a,writer:i}=n;return{[o]:{get(){const t=this.data.get(r);return null!==t?a(t):n.defaultValue},set(t){void 0===t?this.data.delete(r):this.data.set(r,i(t))}},[`has${u(o)}`]:{get(){return this.data.has(r)||n.hasCustomDefaultValue}}}}(e))),n)},function(t){return l(t,"outlets").reduce(((t,e)=>Object.assign(t,function(t){const e=c(t.replace(/--/g,"-").replace(/__/g,"_"));return{[`${e}Outlet`]:{get(){const e=this.outlets.find(t);if(e){const n=this.application.getControllerForElementAndIdentifier(e,t);if(n)return n;throw new Error(`Missing "data-controller=${t}" attribute on outlet element for "${this.identifier}" controller`)}throw new Error(`Missing outlet element "${t}" for "${this.identifier}" controller`)}},[`${e}Outlets`]:{get(){const e=this.outlets.findAll(t);return e.length>0?e.map((e=>{const n=this.application.getControllerForElementAndIdentifier(e,t);if(n)return n;console.warn(`The provided outlet element is missing the outlet controller "${t}" for "${this.identifier}"`,e)})).filter((t=>t)):[]}},[`${e}OutletElement`]:{get(){const e=this.outlets.find(t);if(e)return e;throw new Error(`Missing outlet element "${t}" for "${this.identifier}" controller`)}},[`${e}OutletElements`]:{get(){return this.outlets.findAll(t)}},[`has${u(e)}Outlet`]:{get(){return this.outlets.has(t)}}}}(e))),{})}],w.targets=[],w.outlets=[],w.values={};const S={debug:!1,logger:console,dispatchEvent:!0,eventPrefix:!0};class k{constructor(t,e={}){var n,r,o;this.log=(t,e)=>{this.debug&&(this.logger.groupCollapsed(`%c${this.controller.identifier} %c#${t}`,"color: #3B82F6","color: unset"),this.logger.log(Object.assign({controllerId:this.controllerId},e)),this.logger.groupEnd())},this.warn=t=>{this.logger.warn(`%c${this.controller.identifier} %c${t}`,"color: #3B82F6; font-weight: bold","color: unset")},this.dispatch=(t,e={})=>{if(this.dispatchEvent){const{event:n}=e,r=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]])}return n}(e,["event"]),o=this.extendedEvent(t,n||null,r);this.targetElement.dispatchEvent(o),this.log("dispatchEvent",Object.assign({eventName:o.type},r))}},this.call=(t,e={})=>{const n=this.controller[t];if("function"==typeof n)return n.call(this.controller,e)},this.extendedEvent=(t,e,n)=>{const{bubbles:r,cancelable:o,composed:a}=e||{bubbles:!0,cancelable:!0,composed:!0};return e&&Object.assign(n,{originalEvent:e}),new CustomEvent(this.composeEventName(t),{bubbles:r,cancelable:o,composed:a,detail:n})},this.composeEventName=t=>{let e=t;return!0===this.eventPrefix?e=`${this.controller.identifier}:${t}`:"string"==typeof this.eventPrefix&&(e=`${this.eventPrefix}:${t}`),e},this.debug=null!==(r=null!==(n=null==e?void 0:e.debug)&&void 0!==n?n:t.application.stimulusUseDebug)&&void 0!==r?r:S.debug,this.logger=null!==(o=null==e?void 0:e.logger)&&void 0!==o?o:S.logger,this.controller=t,this.controllerId=t.element.id||t.element.dataset.id,this.targetElement=(null==e?void 0:e.element)||t.element;const{dispatchEvent:a,eventPrefix:i}=Object.assign({},S,e);Object.assign(this,{dispatchEvent:a,eventPrefix:i}),this.controllerInitialize=t.initialize.bind(t),this.controllerConnect=t.connect.bind(t),this.controllerDisconnect=t.disconnect.bind(t)}}(class extends w{}).debounces=[];class O extends k{constructor(t,e={}){super(t,e),this.observe=()=>{try{this.observer.observe(this.targetElement,this.options)}catch(t){this.controller.application.handleError(t,"At a minimum, one of childList, attributes, and/or characterData must be true",{})}},this.unobserve=()=>{this.observer.disconnect()},this.mutation=t=>{this.call("mutate",t),this.log("mutate",{entries:t}),this.dispatch("mutate",{entries:t})},this.targetElement=(null==e?void 0:e.element)||t.element,this.controller=t,this.options=e,this.observer=new MutationObserver(this.mutation),this.enhanceController(),this.observe()}enhanceController(){const t=this.controller.disconnect.bind(this.controller);Object.assign(this.controller,{disconnect:()=>{this.unobserve(),t()}})}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function j(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function A(t){return A=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},A(t)}function I(t,e){return I=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},I(t,e)}function E(t){return function(t){if(Array.isArray(t))return _(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=A(t);if(e){var s=A(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r):o}}(class extends w{}).throttles=[];var T=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&I(t,e)}(o,Stacks.StacksController);var e,n,r=C(o);function o(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),r.apply(this,arguments)}return e=o,(n=[{key:"container",get:function(){return this.hasContainerTarget?this.containerTarget:this.element}},{key:"children",get:function(){return Array.from(this.hasScopeSelectorValue?this.container.querySelectorAll(this.scopeSelectorValue):this.container.children)}},{key:"connect",value:function(){((t,e={})=>{const n=new O(t,e);n.observe,n.unobserve})(this,{childList:!0,element:this.container}),this.checkEmpty()}},{key:"mutate",value:function(){this.checkEmpty()}},{key:"checkEmpty",value:function(){var t,e,n,r,o=this.children.length;0===o?((t=this.element.classList).remove.apply(t,E(this.notEmptyClasses)),(e=this.element.classList).add.apply(e,E(this.emptyClasses)),this.dispatch("empty",{target:this.container})):((n=this.element.classList).add.apply(n,E(this.notEmptyClasses)),(r=this.element.classList).remove.apply(r,E(this.emptyClasses)),this.dispatch("not-empty",{target:this.container,detail:{count:o}}))}}])&&j(e.prototype,n),o}();x(T,"controllerId","empty-dom"),x(T,"targets",["container"]),x(T,"classes",["empty","notEmpty"]),x(T,"values",{scopeSelector:String});function P(t,e){var n=localStorage[t];return function(t){return![null,void 0,""].includes(t)}(n)?JSON.parse(n):e}var U,R=function(t){return null!==t&&"object"==typeof t};function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var M={openedSections:(U={},L(U,"".concat(t,"-connected-histogram"),!0),L(U,"".concat(t,"-connected"),!1),L(U,"".concat(t,"-focused"),!1),U),showOnlyConnected:!1};function F(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var $,D,B,q=($=[function t(e,n){return R(e)?new Proxy(e,{get:function(e,r,o){var a=Reflect.get(e,r,o);return R(a)?t(a,n):a},set:function(t,e,r,o){var a=Reflect.set(t,e,r,o);return n(),a}}):e}((B={storage:P(D=t,{focusedUsers:[],xrefUIState:M}),persist:function(){return localStorage[D]=JSON.stringify(B.storage)}}).storage,function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return function(){for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];var i=this;clearTimeout(e),e=setTimeout((function(){return t.apply(i,o)}),n)}}(B.persist)),function(){var t=P(D,B.storage),e=!0,n=!1,r=void 0;try{for(var o,a=Object.keys(B.storage)[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var i=o.value;B.storage[i]=t[i]}}catch(t){n=!0,r=t}finally{try{e||null==a.return||a.return()}finally{if(n)throw r}}}],2,function(t){if(Array.isArray(t))return t}($)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),2!==a.length);i=!0);}catch(t){s=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}($)||function(t,e){if(t){if("string"==typeof t)return F(t,2);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(t,2):void 0}}($)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),H=q[0],N=q[1];function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function G(t){var e,n;function r(e,n){try{var a=t[e](n),i=a.value,s=i instanceof Y;Promise.resolve(s?i.wrapped:i).then((function(t){s?r("next",t):o(a.done?"return":"normal",t)}),(function(t){r("throw",t)}))}catch(t){o("throw",t)}}function o(t,o){switch(t){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):n=null}this._invoke=function(t,o){return new Promise((function(a,i){var s={key:t,arg:o,resolve:a,reject:i,next:null};n?n=n.next=s:(e=n=s,r(t,o))}))},"function"!=typeof t.return&&(this.return=void 0)}function V(t,e){var n={},r=!1;function o(n,o){return r=!0,o=new Promise((function(e){e(t[n](o))})),{done:!1,value:e(o)}}return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(t){return r?(r=!1,t):o("next",t)},"function"==typeof t.throw&&(n.throw=function(t){if(r)throw r=!1,t;return o("throw",t)}),"function"==typeof t.return&&(n.return=function(t){return o("return",t)}),n}function J(t){var e,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(r&&null!=(e=t[r]))return new W(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function W(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return W=function(t){this.s=t,this.n=t.next},W.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new W(t)}function K(t,e,n,r,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Q(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){K(a,r,o,i,s,"next",t)}function s(t){K(a,r,o,i,s,"throw",t)}i(void 0)}))}}function X(t){return new Y(t)}function Y(t){this.wrapped=t}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e,n){return et=dt()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var o=new(Function.bind.apply(t,r));return n&&ct(o,n.prototype),o},et.apply(null,arguments)}function nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function rt(t,e,n){return e&&nt(t.prototype,e),n&&nt(t,n),t}function ot(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function at(t){return at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},at(t)}function it(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ot(t,e,n[e])}))}return t}function st(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n.push.apply(n,r)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}function ct(t,e){return ct=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},ct(t,e)}function ut(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(t,e)||lt(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lt(t,e){if(t){if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}function ft(t){var e="function"==typeof Map?new Map:void 0;return ft=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return et(t,arguments,at(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ct(r,t)},ft(t)}function dt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}"function"==typeof Symbol&&Symbol.asyncIterator&&(G.prototype[Symbol.asyncIterator]=function(){return this}),G.prototype.next=function(t){return this._invoke("next",t)},G.prototype.throw=function(t){return this._invoke("throw",t)},G.prototype.return=function(t){return this._invoke("return",t)};var ht=function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},pt=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ct(t,e)}(o,t);var e,n,r=(e=o,n=dt(),function(){var t,r,o,a,i=at(e);if(n){var s=at(this).constructor;t=Reflect.construct(i,arguments,s)}else t=i.apply(this,arguments);return r=this,!(o=t)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?Z(r):o});function o(t,e,n){var a;return tt(this,o),ot(Z(a=r.call(this,"".concat(n," (").concat(t,"): ").concat(e))),"errorId",void 0),ot(Z(a),"errorMessage",void 0),ot(Z(a),"errorName",void 0),a.errorId=t,a.errorMessage=e,a.errorName=n,a.name="APIError",a}return rt(o,null,[{key:"fromWrapper",value:function(t){return new o(t.error_id,t.error_message,t.error_name)}}]),o}(ft(Error)),vt=function(t){return"string"==typeof t?t:(e=t,n=Date,(null!=n&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](e):e instanceof n)?Math.round(t.getTime()/1e3):t).toFixed(0);var e,n},bt=function t(e){var n=this;tt(this,t),ot(this,"promise",void 0),ot(this,"resolve",void 0),ot(this,"then",void 0),this.promise=void 0===e?new Promise((function(t){n.resolve=t})):Promise.resolve(e),this.then=this.promise.then.bind(this.promise)},gt=new bt(0),mt=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;tt(this,t),ot(this,"apiKey",void 0),ot(this,"defaultPageSize",void 0),ot(this,"siteId",void 0),ot(this,"notBeforeFutures",void 0),this.apiKey=e,this.defaultPageSize=r,this.notBeforeFutures=new Map,this.siteId=n||location.hostname.replace(/(\.stackexchange)?\.com$/,"")}return rt(t,[{key:"fetch",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this;return Q((function(){return ht(this,(function(o){switch(o.label){case 0:return[4,r.fetchItems(t,e,n)];case 1:return[2,o.sent().items]}}))}))()}},{key:"fetchItems",value:function(t,e,n){var r=this;return Q((function(){var o,a,i,s;return ht(this,(function(c){switch(c.label){case 0:return o=r.buildURL(t,e,n),[4,r.handleBackoff(t)];case 1:a=c.sent(),c.label=2;case 2:return c.trys.push([2,5,,6]),[4,fetch(o.toString())];case 3:return[4,c.sent().json()];case 4:return i=c.sent(),a((new Date).getTime()+1e3*(i.backoff||0)),[3,6];case 5:throw s=c.sent(),a(0),s;case 6:if(function(t){return void 0!==t.error_id}(i))throw yt.fromWrapper(i);return[2,i]}}))}))()}},{key:"fetchAll",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this;return(e=function(){var e,a,i,s,c,u,l,f,d,h,p;return ht(this,(function(y){switch(y.label){case 0:e=r.pageSize||o.defaultPageSize,a=!0,i=!1,s=void 0,y.label=1;case 1:y.trys.push([1,9,10,11]),c=o.pathParameterBatches(t,n,e)[Symbol.iterator](),y.label=2;case 2:if(a=(u=c.next()).done)return[3,8];l=u.value,d=parseInt((null===(f=l.page)||void 0===f?void 0:f.toString())||"1"),h=void 0,y.label=3;case 3:return[4,X(o.fetchItems(t,st(it({},l),{page:d}),r))];case 4:return h=y.sent(),void 0!==r.compareFn&&h.items.sort(r.compareFn),[5,pt(V(J(h.items),X))];case 5:y.sent(),d+=1,y.label=6;case 6:if(h.has_more)return[3,3];y.label=7;case 7:return a=!0,[3,2];case 8:return[3,11];case 9:return p=y.sent(),i=!0,s=p,[3,11];case 10:try{a||null==c.return||c.return()}finally{if(i)throw s}return[7];case 11:return[2]}}))},function(){return new G(e.apply(this,arguments))})()}},{key:"pathParameterBatches",value:function(t,e,n){var r,o,a=Array.from(t.matchAll(/{(\w+)}/g)).map((function(t){return t[1]}));switch(a.length){case 0:return[e];case 1:var i=[a[0],e[a[0]]],s=i[0],c=i[1];if(void 0===c)throw Error("Missing path parameter ".concat(s));return(r=function(t){return Array.isArray(t)?t:[t]}(c),o=n,r.reduce((function(t,e,n){var r=Math.floor(n/o);return t[r]=function(t){return function(t){if(Array.isArray(t))return z(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||lt(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(r<t.length?t[r]:[]).concat([e]),t}),[])).map((function(t){return st(it({},e),ot({},s,t))}));default:throw Error("Can't batch multiple path parameters")}}},{key:"buildURL",value:function(t,e,n){var r=new URLSearchParams(st(it({},n.filter&&{filter:n.filter},this.apiKey&&{key:this.apiKey}),{site:this.siteId,pagesize:(void 0===n.pageSize?this.defaultPageSize:n.pageSize).toFixed(0)})),o=t,a=!0,i=!1,s=void 0;try{for(var c,u=Object.entries(e)[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=ut(c.value,2),f=l[0],d=l[1],h=(Array.isArray(d)?d:[d]).map(vt).join(";"),p="/{".concat(f,"}");o.includes(p)?o=o.replaceAll(p,"/".concat(h)):r.append(f,h)}}catch(t){i=!0,s=t}finally{try{a||null==u.return||u.return()}finally{if(i)throw s}}if(null!==o.match(/\/{\w+}/))throw new Error("Missing path parameters: ".concat(o));var y=new URL("".concat("https://api.stackexchange.com/2.3").concat(o));return y.search=r.toString(),y}},{key:"handleBackoff",value:function(t){var e=this;return Q((function(){var n,r,o,a,i;return ht(this,(function(s){switch(s.label){case 0:return n=t.startsWith("/me")?"/users/{ids}".concat(t.substring(3)):t,o=null!==(r=e.notBeforeFutures.get(n))&&void 0!==r?r:gt,a=new bt,e.notBeforeFutures.set(n,a),[4,o];case 1:return(i=s.sent()-(new Date).getTime())>0?[4,(c=i,new Promise((function(t){return setTimeout(t,c)})))]:[3,3];case 2:s.sent(),s.label=3;case 3:return[2,a.resolve]}var c}))}))()}}]),t}();function wt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function St(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function kt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ot(t,e,n){return e&&kt(t.prototype,e),n&&kt(t,n),t}function _t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function jt(t){return jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},jt(t)}function xt(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&At(t,e)}function At(t,e){return At=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},At(t,e)}function It(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=jt(t);if(e){var s=jt(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?wt(r):o}}var Et=new Intl.NumberFormat("en-US",{notation:"compact",maximumSignificantDigits:3}),Ct=new Intl.NumberFormat("en-US",{useGrouping:!0}),Tt=function(){function t(){St(this,t),_t(this,"user_id",void 0),_t(this,"link",void 0),_t(this,"cachedNode",null)}return Ot(t,[{key:"relativeLink",get:function(){var t=new URL(this.link);return t.origin===location.origin?t.pathname:this.link}},{key:"node",get:function(){if(null===this.cachedNode){var t=document.createElement("div");t.innerHTML=this.toHTML(),this.cachedNode=t.firstElementChild}return this.cachedNode}}]),t}(),Pt=function(t){xt(n,t);var e=It(n);function n(){var t;return St(this,n),_t(wt(t=e.apply(this,arguments)),"badge_counts",void 0),_t(wt(t),"display_name",void 0),_t(wt(t),"profile_image",void 0),_t(wt(t),"reputation",void 0),_t(wt(t),"is_employee",void 0),_t(wt(t),"user_type",void 0),t}return Ot(n,[{key:"badges",get:function(){var t=[];switch(this.is_employee&&t.push('<span class="s-badge s-badge__staff s-badge__xs">Staff</span>'),this.user_type){case"moderator":t.push('<span class="s-badge s-badge__moderator s-badge__xs">Mod</span>');break;case"team_admin":t.push('<span class="s-badge s-badge__admin s-badge__xs">Admin</span>')}return t.join(" ")}},{key:"abbreviatedReputation",get:function(){return this.reputation<1e4?Ct.format(this.reputation):Et.format(this.reputation).toLowerCase()}},{key:"toHTML",value:function(){return'\n      <div class="s-user-card" data-uid="'.concat(this.user_id,'"> \n        <a href="').concat(this.relativeLink,'" class="s-avatar s-avatar__32 s-user-card--avatar">\n          <img class="s-avatar--image" src="').concat(this.profile_image,'" />\n        </a>\n        <div class="s-user-card--info">\n          <a href="').concat(this.link,'" class="s-user-card--link"\n            >').concat((t=this.display_name,t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"))," ").concat(this.badges,'</a\n          >\n          <ul class="s-user-card--awards">\n            <li\n              class="s-user-card--rep"\n              title="reputation score ').concat(Ct.format(this.reputation),'"\n            >\n              ').concat(this.abbreviatedReputation,'\n            </li>\n            <li class="s-award-bling s-award-bling__gold">').concat(this.badge_counts.gold,'</li>\n            <li class="s-award-bling s-award-bling__silver">').concat(this.badge_counts.silver,'</li>\n            <li class="s-award-bling s-award-bling__bronze">').concat(this.badge_counts.bronze,"</li>\n          </ul>\n        </div>\n      </div>\n    ");var t}}],[{key:"fromJSON",value:function(t){var e=new this;return Object.assign(e,t),e}}]),n}(Tt),Ut=function(t){xt(n,t);var e=It(n);function n(t){var r;return St(this,n),(r=e.call(this)).user_id=t||0,r.link="".concat(location.origin,"/users/").concat(r.user_id),r}return Ot(n,[{key:"toHTML",value:function(){return'\n      <div class="s-user-card s-user-card__deleted">\n        <a href="'.concat(this.relativeLink,'" class="s-avatar s-avatar__32 s-user-card--avatar">\n          <span class="anonymous-gravatar s-avatar--image"></span>\n        </a>\n        <div class="s-user-card--info">\n          <a href="').concat(this.link,'" class="s-user-card--link"\n            >user').concat(this.user_id,"</a\n          >\n        </div>\n      </div>\n    ")}}]),n}(Tt);function Rt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Lt(t){var e,n;function r(e,n){try{var a=t[e](n),i=a.value,s=i instanceof Bt;Promise.resolve(s?i.wrapped:i).then((function(t){s?r("next",t):o(a.done?"return":"normal",t)}),(function(t){r("throw",t)}))}catch(t){o("throw",t)}}function o(t,o){switch(t){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):n=null}this._invoke=function(t,o){return new Promise((function(a,i){var s={key:t,arg:o,resolve:a,reject:i,next:null};n?n=n.next=s:(e=n=s,r(t,o))}))},"function"!=typeof t.return&&(this.return=void 0)}function Mt(t,e){var n={},r=!1;function o(n,o){return r=!0,o=new Promise((function(e){e(t[n](o))})),{done:!1,value:e(o)}}return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(t){return r?(r=!1,t):o("next",t)},"function"==typeof t.throw&&(n.throw=function(t){if(r)throw r=!1,t;return o("throw",t)}),"function"==typeof t.return&&(n.return=function(t){return o("return",t)}),n}function Ft(t){var e,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(r&&null!=(e=t[r]))return new $t(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function $t(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return $t=function(t){this.s=t,this.n=t.next},$t.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new $t(t)}function Dt(t){return new Bt(t)}function Bt(t){this.wrapped=t}function qt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ht(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}"function"==typeof Symbol&&Symbol.asyncIterator&&(Lt.prototype[Symbol.asyncIterator]=function(){return this}),Lt.prototype.next=function(t){return this._invoke("next",t)},Lt.prototype.throw=function(t){return this._invoke("throw",t)},Lt.prototype.return=function(t){return this._invoke("return",t)};var Nt=function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},zt=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Zt=function(){function t(e,n,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Ht(this,"UserClass",void 0),Ht(this,"MissingClass",void 0),Ht(this,"api",void 0),Ht(this,"cache",void 0),Ht(this,"missingAssumeDeleted",void 0),this.UserClass=e,this.MissingClass=n,this.missingAssumeDeleted=!1,this.api=r.api,this.cache=r.cache,this.missingAssumeDeleted=r.missingAssumeDeleted}var e,n,r;return e=t,n=[{key:"users",value:function(t){var e,n=this;return(e=function(){var e,r,o,a,i,s,c,u,l,f,d,h,p,y,v,b;function g(t){var e,n,r,i,s,c,u,l;return Nt(this,(function(f){switch(f.label){case 0:e=!0,n=!1,r=void 0,f.label=1;case 1:f.trys.push([1,6,7,8]),i=a[Symbol.iterator](),f.label=2;case 2:return(e=(s=i.next()).done)||(c=s.value)===t?[3,5]:(u=o(c))?[4,u]:[3,4];case 3:f.sent(),f.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return l=f.sent(),n=!0,r=l,[3,8];case 7:try{e||null==i.return||i.return()}finally{if(n)throw r}return[7];case 8:return[2]}}))}return Nt(this,(function(m){switch(m.label){case 0:if(e=[],r=new Map(t.reduce((function(t,r){var o=n.cache.get(r);return void 0===o&&e.push(r),void 0!==o?function(t){return function(t){if(Array.isArray(t))return Rt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Rt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t).concat([[r,o]]):t}),[])),o=n.missingAssumeDeleted?function(t){return r.get(t)||n.missingUser(t)}:function(t){return r.get(t)},a=t.values(),!(e.length>0))return[3,14];i=new Map(e.map((function(t,e){return[t,e]}))),s={filter:")Q7.NL.wLaTOvZyxvEF8za4m(g8T",compareFn:function(t,e){return i.get(t.user_id)-i.get(e.user_id)}},c=n.api.fetchAll("/users/{ids}",{ids:e},s),u=!1,l=!1,m.label=1;case 1:m.trys.push([1,8,9,14]),d=Ft(c),m.label=2;case 2:return[4,Dt(d.next())];case 3:return(u=!(h=m.sent()).done)?(p=h.value,y=p,v=n.UserClass.fromJSON(y),n.cache.put(v.user_id,v),[5,zt(Mt(Ft(g(v.user_id)),Dt))]):[3,7];case 4:return m.sent(),[4,v];case 5:m.sent(),m.label=6;case 6:return u=!1,[3,2];case 7:return[3,14];case 8:return b=m.sent(),l=!0,f=b,[3,14];case 9:return m.trys.push([9,,12,13]),u&&null!=d.return?[4,d.return()]:[3,11];case 10:m.sent(),m.label=11;case 11:return[3,13];case 12:if(l)throw f;return[7];case 13:return[7];case 14:return[5,zt(Mt(Ft(g()),Dt))];case 15:return m.sent(),[2]}}))},function(){return new Lt(e.apply(this,arguments))})()}},{key:"missingUser",value:function(t){var e=new this.MissingClass(t);return this.cache.put(e.user_id,e),e}}],r=[{key:"withDefaultClasses",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={api:e.api||new mt("rSgJSoND0c32iHgumlM8vg(("),cache:e.cache||new a(1e3),missingAssumeDeleted:void 0!==e.missingAssumeDeleted&&e.missingAssumeDeleted};return new t(Pt,Ut,n)}}],n&&qt(e.prototype,n),r&&qt(e,r),t}();function Gt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Vt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Jt(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return Jt=function(t){this.s=t,this.n=t.next},Jt.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new Jt(t)}function Wt(t,e,n,r,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,o)}function Kt(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){Wt(a,r,o,i,s,"next",t)}function s(t){Wt(a,r,o,i,s,"throw",t)}i(void 0)}))}}function Qt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Xt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Yt(t){return Yt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Yt(t)}function te(t,e){return te=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},te(t,e)}function ee(t){return function(t){if(Array.isArray(t))return Gt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Gt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gt(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ne(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=Yt(t);if(e){var s=Yt(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?Vt(r):o}}var re=".s-".concat(t," .s-user-card { --_uc-p: 0 }"),oe=Zt.withDefaultClasses({missingAssumeDeleted:!0}),ae=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&te(t,e)}(a,Stacks.StacksController);var e,n,r,o=ne(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),Xt(Vt(t=o.apply(this,arguments)),"refreshId",null),t}return e=a,r=[{key:"afterLoad",value:function(t){document.head.insertAdjacentHTML("beforeend",'<style id="'.concat(t,'-styles">').concat(re,"</style>"))}}],(n=[{key:"connect",value:function(){this.updateUsers()}},{key:"updateUsers",value:function(){null!==this.refreshId&&window.cancelAnimationFrame(this.refreshId);var t=this;this.refreshId=window.requestAnimationFrame(Kt((function(){var e,n,r,o,a,i,s,c,u,l,f,d,h,p,y;return function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(v){switch(v.label){case 0:t.countTarget.innerHTML=t.userRowTargets.length.toString(),e=new Map(t.userRowTargets.reduce((function(t,e){return"true"===e.dataset.hydrated?t:ee(t).concat([[parseInt(e.dataset.uid||"0"),e]])}),[])),v.label=1;case 1:if(v.trys.push([1,,14,15]),0===e.size)return[2];n=!1,r=!1,v.label=2;case 2:v.trys.push([2,7,8,13]),a=function(t){var e,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(r&&null!=(e=t[r]))return new Jt(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}(oe.users(ee(e.keys()))),v.label=3;case 3:return[4,a.next()];case 4:if(!(n=!(i=v.sent()).done))return[3,6];if(c=i.value,u=c,!(f=e.get(u.user_id)))return[3,5];d="true"===f.dataset.userCardKeepFirst?null===(l=f.querySelector(".s-user-card :first-child"))||void 0===l?void 0:l.cloneNode(!0):null,(h=f.querySelector(".s-user-card"))?h.replaceWith(u.node):f.replaceChildren(u.node),null==(p=f.querySelector(".s-user-card"))||(s=p.classList).add.apply(s,ee(t.userCardClasses)),d&&(null==p||p.insertAdjacentElement("afterbegin",d)),f.dataset.hydrated="true",v.label=5;case 5:return n=!1,[3,3];case 6:return[3,13];case 7:return y=v.sent(),r=!0,o=y,[3,13];case 8:return v.trys.push([8,,11,12]),n&&null!=a.return?[4,a.return()]:[3,10];case 9:v.sent(),v.label=10;case 10:return[3,12];case 11:if(r)throw o;return[7];case 12:return[7];case 13:return t.dispatch("moduserquicklinks",{prefix:""}),t.dispatch("usersHydrated",{detail:t.userRowTargets.reduce((function(t,e){return null===e.querySelector("s-user-card__deleted")?ee(t).concat([parseInt(e.dataset.uid||"0")]):t}),[])}),[3,15];case 14:return t.refreshId=null,[7];case 15:return[2]}}))})))}}])&&Qt(e.prototype,n),r&&Qt(e,r),a}();Xt(ae,"controllerId","".concat(t,"-user-list")),Xt(ae,"targets",["count","userRow"]),Xt(ae,"classes",["userCard"]);function ie(t){return luxon.Interval.fromDateTimes.apply(this,Array.from(t.querySelectorAll("td .relativetime[title]")).map((function(t){return e=t.title,luxon.DateTime.fromISO(e.replace(" ","T"),{zone:"utc"});var e})))}function se(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ce(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ue(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function le(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function fe(t){return fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},fe(t)}function de(t,e){return de=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},de(t,e)}function he(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(t,e)||ye(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pe(t){return function(t){if(Array.isArray(t))return se(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ye(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ye(t,e){if(t){if("string"==typeof t)return se(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?se(t,e):void 0}}function ve(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=fe(t);if(e){var s=fe(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?ce(r):o}}var be="\n  .s-".concat(t,"__connected-histogram svg rect {\n    fill: var(--theme-secondary-400);\n  }\n  .s-").concat(t,"__connected-histogram svg rect.threshold,\n  .s-").concat(t,"__connected-histogram svg rect.threshold ~ rect{\n    fill: var(--theme-primary-500);\n  }\n  .s-").concat(t,"__connected-histogram svg rect:hover {\n    fill: var(--theme-primary-300) !important;\n  }\n  .s-").concat(t,"__connected-histogram svg .gridLines {\n    stroke: var(--black-150);\n  }\n  "),ge=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&de(t,e)}(a,Stacks.StacksController);var e,n,r,o=ve(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),le(ce(t=o.apply(this,arguments)),"buckets",[]),le(ce(t),"logScale",!1),le(ce(t),"svgRatioCache",void 0),t}return e=a,n=[{key:"connect",value:function(){this.svgTarget.addEventListener("click",this.propagateEvent.bind(this)),this.svgTarget.addEventListener("pointerover",this.propagateEvent.bind(this))}},{key:"disconnect",value:function(){this.svgTarget.removeEventListener("click",this.propagateEvent.bind(this)),this.svgTarget.removeEventListener("pointerover",this.propagateEvent.bind(this))}},{key:"svgRatio",get:function(){if(void 0===this.svgRatioCache){var t=!0,e=!1,n=void 0;try{for(var r,o=function(t){var e,n,r,o,a,i,s,c,u,l,f,d,h,p,y;return function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}(this,(function(v){switch(v.label){case 0:for(e=[],n=t;0===(null==n?void 0:n.clientWidth);n=null==n?void 0:n.parentElement)e.unshift(n);r=[],o=!0,a=!1,i=void 0;try{for(s=e[Symbol.iterator]();!(o=(c=s.next()).done)&&0===(u=c.value).clientWidth;o=!0)(l=u.classList).contains("d-none")&&(l.remove("d-none"),r.push(l))}catch(t){a=!0,i=t}finally{try{o||null==s.return||s.return()}finally{if(a)throw i}}v.label=1;case 1:return v.trys.push([1,,3,4]),[4];case 2:return v.sent(),[3,4];case 3:f=!0,d=!1,h=void 0;try{for(p=r[Symbol.iterator]();!(f=(y=p.next()).done);f=!0)y.value.add("d-none")}catch(t){d=!0,h=t}finally{try{f||null==p.return||p.return()}finally{if(d)throw h}}return[7];case 4:return[2]}}))}(this.svgTarget)[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){r.value;var a=(i=this.svgTarget,void 0,s=window.getComputedStyle(i),{width:i.clientWidth-parseFloat(s.paddingLeft)-parseFloat(s.paddingRight),height:i.clientHeight-parseFloat(s.paddingTop)-parseFloat(s.paddingBottom)});this.svgRatioCache=a.height/a.width}}catch(t){e=!0,n=t}finally{try{t||null==o.return||o.return()}finally{if(e)throw n}}}var i,s;return this.svgRatioCache}},{key:"adjustThresholdClasses",value:function(t){var e;this.svgTarget.querySelectorAll(".threshold").forEach((function(t){return t.classList.remove("threshold")})),null===(e=this.svgTarget.querySelector('rect[data-bucket-conn-count="'.concat(t,'"]')))||void 0===e||e.classList.add("threshold")}},{key:"propagateEvent",value:function(t){var e,n=null===(e=t.target)||void 0===e?void 0:e.closest("svg [data-bucket-index]"),r=null==n?void 0:n.dataset.bucketIndex;if(void 0!==r){var o=parseInt(r);if(!(o<0||o>=this.buckets.length)){t.stopPropagation();var a=this.buckets[o];"click"===t.type&&this.adjustThresholdClasses(a.connCount),this.dispatch(t.type,{detail:a})}}}},{key:"setFrequencies",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.svgTarget.replaceChildren();var n=function(t){if(0===t.length)return{buckets:[],logScale:!1};for(var e=[],n=t[t.length-1].count,r=t[0].count,o=n;o<=r;o++)e.push({connCount:o,userCount:0,label:"Overlapping on ".concat(o," ip").concat(1===o?"":"s")});if(t.forEach((function(t){var r=t.count;return e[r-n].userCount+=1})),e.length>20){for(var a,i=Math.ceil(e.length/20),s=[],c=0;c<e.length;c+=i){var u=e[c].connCount,l=e[Math.min(e.length,c+i)-1].connCount,f=e.slice(c,c+i).reduce((function(t,e){return t+e.userCount}),0);s.push({connCount:u,userCount:f,label:u!==l?"Overlapping on ".concat(u,"-").concat(l," ips"):"Overlapping on ".concat(u," ips")})}e.splice(0,e.length),(a=e).push.apply(a,pe(s))}var d=he(e.reduce((function(t,e){var n=he(t,2),r=n[0],o=n[1],a=e.userCount;return[Math.min(r,Math.max(a,1)),Math.max(o,a)]}),[1/0,1]),2),h=d[0],p=d[1];return{buckets:e,logScale:p>10*h}}(t),r=n.buckets,o=n.logScale;if(this.buckets=r,this.logScale=o,r.length<=1)return{buckets:[],logScale:!1};this.drawBarChart(),this.adjustThresholdClasses(this.buckets[0].connCount),e&&this.dispatch("click",{detail:this.buckets[0]})}},{key:"drawBarChart",value:function(){var t,e=this,n=5*this.buckets.length+1,r=n*this.svgRatio;this.svgTarget.setAttribute("viewBox","0 0 ".concat(n," ").concat(r));var o=this.logScale?function(t){return t>0?Math.log10(t)||.15:t}:function(t){return t},a=(t=Math).max.apply(t,pe(this.buckets.map((function(t){return t.userCount})))),i=r/o(a),s=.005*r;this.svgTarget.insertAdjacentHTML("beforeend",'<g stroke-width="'.concat(s,'" class="gridLines">\n        <defs><line id="gridLine" x1="0" x2="').concat(n,'" y1="0" y2="0" /></defs>\n        <use href="#gridLine" />\n       </g>'));for(var c=this.svgTarget.querySelector("g.gridLines"),u=this.logScale?function(t){return Math.pow(10,Math.floor(Math.log10(t||1)))}:function(t){return arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.max(Math.floor(a/10),1)},l=0;l<a;){var f=r-o(l)*i;c.insertAdjacentHTML("beforeend",'<use href="#gridLine" y="'.concat(f,'" />')),l+=u(l)}this.buckets.forEach((function(t,n){var a=o(t.userCount)*i,s='\n        <rect\n          width="'.concat(4,'" height="').concat(a,'"\n          x="').concat(5*n+1,'"\n          y="').concat(r-a,'"\n          data-bucket-index="').concat(n,'"\n          data-bucket-conn-count="').concat(t.connCount,'"\n        >\n          <title>').concat(t.label,": ").concat(t.userCount," account").concat(1===t.userCount?"":"s","</title>\n        </rect>\n       ");e.svgTarget.insertAdjacentHTML("beforeend",s)}))}}],r=[{key:"afterLoad",value:function(t){document.head.insertAdjacentHTML("beforeend",'<style id="'.concat(t,'-styles">').concat(be,"</style>"))}}],n&&ue(e.prototype,n),r&&ue(e,r),a}();function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function we(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Se(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ke(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Oe(t){return Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Oe(t)}function _e(t,e){return _e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},_e(t,e)}function je(t){return function(t){if(Array.isArray(t))return me(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=Oe(t);if(e){var s=Oe(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?we(r):o}}le(ge,"controllerId","".concat(t,"-histogram")),le(ge,"targets",["svg"]);var Ae="s-mainUser",Ie="s-known",Ee="s-overlap",Ce='\n  [data-controller="'.concat(t,'-ip-group"] tr[data-uid].').concat(Ae,' {\n    background: var(--green-300);\n  }\n  [data-controller="').concat(t,'-ip-group"] tr[data-uid].').concat(Ie,' {\n    background: var(--gold-lighter);\n  }\n  [data-controller="').concat(t,'-ip-group"] tr[data-uid].').concat(Ae,".").concat(Ie,' {\n    background: var(--green-100) !important;\n  }\n  [data-controller="').concat(t,'-ip-group"] tr[data-uid].').concat(Ee,' {\n    background: var(--orange-200);\n  }\n  [data-controller="').concat(t,'-ip-group"] tr[data-uid] .s-btn {\n    display: none;\n  }\n  [data-controller="').concat(t,'-ip-group"] tr[data-uid].').concat(Ie,':hover .s-focus-rm-btn, \n  [data-controller="').concat(t,'-ip-group"] tr[data-uid].').concat(Ie,':focus .s-focus-rm-btn { \n    display: block;\n    background-color: var(--_bu-bg-hover);\n  }\n  [data-controller="').concat(t,'-ip-group"] tr[data-uid]:hover .s-focus-add-btn, \n  [data-controller="').concat(t,'-ip-group"] tr[data-uid]:focus .s-focus-add-btn { \n    display: block;\n    background-color: var(--_bu-bg-hover);\n  }\n  [data-controller="').concat(t,'-ip-group"] tr[data-uid].').concat(Ie,':hover .s-focus-add-btn, \n  [data-controller="').concat(t,'-ip-group"] tr[data-uid].').concat(Ie,":focus .s-focus-add-btn { \n    display: none !important;\n  }\n"),Te='\n<span class="ps-absolute h0">\n  <button class="s-btn s-btn__icon s-btn__xs s-focus-add-btn ps-relative l96 tn4"\n          data-controller="s-tooltip"\n          data-action="'.concat(t,'#addFocusUser"\n          title="Add this user to the focused accounts list"\n    >').concat(s,' <span class="md:d-none">Focus</span></button></span>\n<span class="ps-absolute h0">\n  <button class="s-btn s-btn__icon s-btn__xs s-btn__danger s-focus-rm-btn ps-relative l96 tn4"\n          data-controller="s-tooltip"\n          data-action="').concat(t,'#removeFocusUser"\n          title="Remove this user from the focused accounts list"\n    >').concat(i,' <span class="md:d-none">Remove</span></button></span>\n'),Pe=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_e(t,e)}(s,Stacks.StacksController);var n,r,a,i=xe(s);function s(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),ke(we(t=i.apply(this,arguments)),"belowThreshold",new Set),ke(we(t),"showOnlyConnected",void 0),ke(we(t),"refreshId",null),t}return n=s,r=[{key:"userRows",get:function(){return Array.from(this.element.querySelectorAll("tbody > tr[data-uid]"))}},{key:"mainUserRow",get:function(){return this.element.querySelector("tbody .".concat(Ae))}},{key:"focusUserRows",get:function(){var t=new Set(H.focusedUsers);return this.userRows.filter((function(e){return t.has(parseInt(e.dataset.uid))}))}},{key:"focusIntervals",get:function(){return[this.mainUserRow].concat(je(this.focusUserRows)).map(ie)}},{key:"connectedUserRows",get:function(){var t=this.focusIntervals,e=new Set(H.focusedUsers);return this.userRows.filter((function(n){if(n.matches(".".concat(Ae)))return!1;if(e.has(parseInt(n.dataset.uid)))return!1;var r=ie(n);return t.some((function(t){return t.overlaps(r)}))}))}},{key:"connectedUsers",get:function(){return this.connectedUserRows.map((function(t){return parseInt(t.dataset.uid)}))}},{key:"updateMarkup",value:function(){var t;this.element.querySelectorAll("td tbody tr").forEach((function(t){var e=t.querySelector('td a[href^="/users/"]');e&&(t.dataset.uid=e.href.split("/").pop())}));var e=location.pathname.split("/").pop();null===(t=this.element.querySelector('tr[data-uid="'.concat(e,'"]')))||void 0===t||t.classList.add(Ae)}},{key:"connect",value:function(){this.updateMarkup(),this.showOnlyConnected=H.xrefUIState.showOnlyConnected,this.addFocusButtons(),this.updateClasses()}},{key:"addFocusButtons",value:function(){this.userRows.forEach((function(e){var n;null===(n=e.querySelector('td a[href^="/users/"]'))||void 0===n||n.insertAdjacentHTML("beforebegin",Te);var r="".concat(o(t),"UidParam"),a=e.dataset.uid;e.querySelectorAll("td .s-btn[data-action]").forEach((function(t){t.dataset[r]=a}))}))}},{key:"updateClasses",value:function(){this.userRows.forEach((function(t){t.classList.remove(Ie,Ee,"d-none")})),this.focusUserRows.forEach((function(t){t.classList.add(Ie)}));var t=this.belowThreshold.has.bind(this.belowThreshold);if(this.connectedUserRows.forEach((function(e){e.classList.toggle(Ee,!t(e.dataset.uid))})),this.showOnlyConnected){var e=".".concat(Ae,",.").concat(Ie,",.").concat(Ee),n=!0,r=!1,o=void 0;try{for(var a,i=this.userRows[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){var s=a.value;s.matches(e)||s.classList.add("d-none")}}catch(t){r=!0,o=t}finally{try{n||null==i.return||i.return()}finally{if(r)throw o}}}}},{key:"refresh",value:function(t){var e=this;void 0!==t&&(this.showOnlyConnected=t),null!==this.refreshId&&window.cancelAnimationFrame(this.refreshId),this.refreshId=window.requestAnimationFrame((function(){e.updateClasses(),e.refreshId=null}))}},{key:"updateUsersBelowThreshold",value:function(t,e){this.belowThreshold=new Set(e.reduce((function(e,n){var r=n.uid;return n.count<t?je(e).concat([r.toFixed(0)]):e}),[])),this.refresh()}}],a=[{key:"afterLoad",value:function(t,e){e.logDebugActivity(t,"afterLoad"),document.head.insertAdjacentHTML("beforeend",'<style id="'.concat(t,'-styles">').concat(Ce,"</style>"))}}],r&&Se(n.prototype,r),a&&Se(n,a),s}();function Ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Re(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Le(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Me(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Fe(t){return Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},Fe(t)}function $e(t,e){return $e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},$e(t,e)}function De(t){return function(t){if(Array.isArray(t))return Ue(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||Be(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(t,e){if(t){if("string"==typeof t)return Ue(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ue(t,e):void 0}}function qe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=Fe(t);if(e){var s=Fe(this).constructor;n=Reflect.construct(i,arguments,s)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?Re(r):o}}ke(Pe,"controllerId","".concat(t,"-ip-group"));var He="tr.odd, tr.even, tr.ip-group",Ne=".s-".concat(t,"__connected-histogram"),ze="\n.s-".concat(t," .s-btn__copy.is-copied .v-hidden {\n  visibility: inherit !important;\n}\n"),Ze='\n<div class="s-'.concat(t,' ps-sticky h0 t0 d-grid z-nav"\n     data-action="storage@window->').concat(t,'#reloadPreferences">\n  <div id="').concat(t,'" role="navigation" aria-label="Connected users"\n       class="o50 h:o100 f:o100 ws3 s-sidebarwidget ps-relative t128 l16">\n\n    <div data-controller="').concat(T.controllerId,'"\n         data-').concat(T.controllerId,'-empty-class="d-none"\n      >\n      <h2 class="s-sidebarwidget--header s-sidebarwidget__small-bold-text\n                s-sidebarwidget__expanding-control"\n          aria-expanded="false"\n          aria-controls="').concat(t,'-connected-histogram"\n          aria-label="toggle connected users histogram"\n          data-controller="s-expandable-control"\n          data-action="\n            s-expandable-control:show->').concat(t,"#sectionToggled\n            s-expandable-control:hide->").concat(t,'#sectionToggled\n          "\n          tabindex="0">\n        <span>Connected users histogram</span>\n      </h2>\n      <div class="s-expandable s-').concat(t,'__connected-histogram"\n          data-controller="').concat(ge.controllerId,'"\n          data-action="').concat(ge.controllerId,":click->").concat(t,'#showConnected"\n          id="').concat(t,'-connected-histogram"\n        >\n        <div class="s-expandable--content">\n          <svg xmlns="http://www.w3.org/2000/svg"\n              class="s-sidebarwidget--content w100 hs1"\n              data-').concat(ge.controllerId,'-target="svg"\n              data-').concat(T.controllerId,'-target="container"\n              ></svg>\n        </div>\n      </div>\n    </div>\n\n    <div data-controller="').concat(T.controllerId," ").concat(ae.controllerId,'"\n         data-').concat(T.controllerId,'-empty-class="d-none"\n         data-action="').concat(T.controllerId,":not-empty->").concat(ae.controllerId,'#updateUsers"\n      >\n      <h2 class="s-sidebarwidget--header s-sidebarwidget__small-bold-text\n                s-sidebarwidget__expanding-control"\n          aria-expanded="false"\n          aria-controls="').concat(t,'-connected"\n          aria-label="toggle connected users"\n          data-controller="s-expandable-control"\n          data-action="\n            s-expandable-control:show->').concat(t,"#sectionToggled\n            s-expandable-control:hide->").concat(t,'#sectionToggled\n          "\n          tabindex="0">\n        <div class="s-check-control s-sidebarwidget--action"\n            data-action="click->').concat(t,'#toggleOnly:stop"\n            data-controller="s-tooltip"\n            title="Hide all users not connected to the focus account(s)"\n          >\n          <label class="s-label s-label__sm" for="').concat(t,'-toggle-only-connected">Only</label>\n          <input class="s-checkbox" type="checkbox"\n            id="').concat(t,'-toggle-only-connected"\n            />\n        </div>\n        <span data-').concat(ae.controllerId,'-target="count">0</span> Connected users\n      </h2>\n      <div class="s-expandable" id="').concat(t,'-connected">\n        <div class="s-expandable--content">\n          <div class="s-sidebarwidget--content\n                      s-sidebarwidget__items\n                      overflow-y-auto\n                      hmx2\n                     "\n               data-').concat(T.controllerId,'-target="container"\n               data-').concat(t,'-target="connectedUsers"\n            >\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div data-controller="').concat(T.controllerId," ").concat(ae.controllerId,'"\n         data-').concat(T.controllerId,'-empty-class="d-none"\n         data-action="\n             ').concat(T.controllerId,":not-empty->").concat(ae.controllerId,"#updateUsers\n             ").concat(ae.controllerId,":usersHydrated->").concat(t,'#updateFocusUsersGraphLink\n             "\n      >\n      <h2 class="s-sidebarwidget--header s-sidebarwidget__small-bold-text\n                s-sidebarwidget__expanding-control"\n          aria-expanded="false"\n          aria-controls="').concat(t,'-focused"\n          aria-label="toggle focused users"\n          data-controller="s-expandable-control"\n          data-action="\n            s-expandable-control:show->').concat(t,"#sectionToggled\n            s-expandable-control:hide->").concat(t,'#sectionToggled\n          "\n          tabindex="0">\n        <button class="\n              s-sidebarwidget--action\n              s-btn s-btn__icon s-btn__danger s-btn__xs s-btn__link fc-danger\n              "\n            data-controller="s-tooltip"\n            data-action="').concat(t,'#clearFocusUsers:stop"\n            title="Clear the list of focus accounts"\n        >').concat('<svg aria-hidden="true" class="svg-icon iconTrashSm" width="14" height="14"  viewBox="0 0 14 14"><path  d="M11 2a1 1 0 0 1 1 1v1H2V3a1 1 0 0 1 1-1h2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h2Zm0 3H3v6c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V5Z"/></svg>','<span class="v-visible-sr">Clear</button>\n        <a class="\n              s-sidebarwidget--action\n              s-btn s-btn__icon s-btn__xs p0\n              "\n            data-controller="s-tooltip"\n            data-').concat(t,'-target="focusUsersGraphLink"\n            data-action="').concat(t,'#openFocusUsersGraph:stop"\n            title="IP activity graph for focus accounts"\n            target="_blank"\n            href="/admin/user-activity"\n        >').concat('<svg aria-hidden="true" class="svg-icon iconReputationSm" width="14" height="14"  viewBox="0 0 14 14"><path  d="M9.67 1.5a1 1 0 0 1 .86-.5H12a1 1 0 1 1 0 2h-.89L9.67 5.5a1 1 0 0 1-.87.5H6.62l-3.23 6.45a1 1 0 1 1-1.78-.9l3.5-7A1 1 0 0 1 6 4h2.22l1.45-2.5Z"/><path  d="M1 2a1 1 0 0 1 1-1h5a1 1 0 0 1 0 2H2a1 1 0 0 1-1-1Zm0 3a1 1 0 1 1 2 0 1 1 0 0 1-2 0Zm11-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2ZM8 8a1 1 0 0 1 1-1h3a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Zm-1 2a1 1 0 1 0 0 2h5a1 1 0 1 0 0-2H7Z" opacity=".2"/></svg>','<span class="v-visible-sr">Clear</a>\n        <button class="\n              s-sidebarwidget--action\n              s-btn s-btn__icon s-btn__xs s-btn__link\n              s-btn__copy\n              "\n            data-controller="s-tooltip"\n            data-action="').concat(t,'#copyFocusUsers:stop"\n            title="Copy the list of focus users to the clipboard"\n        >').concat('<svg aria-hidden="true" class="svg-icon iconShareSm" width="14" height="14"  viewBox="0 0 14 14"><path  d="M5 1H3a2 2 0 0 0-2 2v8c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V9h-2v2H3V3h2V1Zm2 0h6v6h-2V4.5L6.5 9 5 7.5 9.5 3H7V1Z"/></svg>','<span\n            class="fc-success bg-black-025 ps-absolute l0 v-hidden"\n        >').concat('<svg aria-hidden="true" class="svg-icon iconCheckmarkSm" width="14" height="14"  viewBox="0 0 14 14"><path  d="M13 3.41 11.59 2 5 8.59 2.41 6 1 7.41l4 4 8-8Z"/></svg>','</span><span class="v-visible-sr">Copy</span></button>\n        <span data-').concat(ae.controllerId,'-target="count">0</span> Focused users\n      </h2>\n      <div class="s-expandable" id="').concat(t,'-focused">\n        <div class="s-expandable--content">\n          <div class="s-sidebarwidget--content\n                      s-sidebarwidget__items\n                      overflow-y-auto\n                      hmx2\n                     "\n               data-').concat(T.controllerId,'-target="container"\n               data-').concat(t,'-target="focusedUsers"\n            >\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n');function Ge(t){return t.toFormat("yyyy/MM/dd")}var Ve,Je=function(t){var e=t.controllerId;return"".concat(o(e),"OutletConnected")}(ge),We=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&$e(t,e)}(u,Stacks.StacksController);var n,r,a,c=qe(u);function u(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),Me(Re(t=c.apply(this,arguments)),"threshold",0),Me(Re(t),"refreshId",null),t}return n=u,r=[{key:"ipGroups",get:function(){return this[function(t){var e=t.controllerId;return"".concat(o("".concat(e)),"Outlets")}(Pe)]}},{key:"histogram",get:function(){return this[function(t){var e=t.controllerId;return"".concat(o("".concat(e)),"Outlet")}(ge)]}},{key:"uiDiv",get:function(){var e=this.element.querySelector(".s-".concat(this.identifier));if(null===e){var n,r=document.createElement("div");r.insertAdjacentHTML("afterbegin",Ze);var o=r.firstElementChild;o.querySelectorAll('[data-controller="s-expandable-control"]').forEach((function(t){var e,n=t.getAttribute("aria-controls");n&&H.xrefUIState.openedSections[n]&&(t.setAttribute("aria-expanded","true"),null===(e=o.querySelector("#".concat(n)))||void 0===e||e.classList.add("is-expanded"))})),null===(n=o.querySelector("#".concat(t,"-toggle-only-connected")))||void 0===n||n.toggleAttribute("checked",H.xrefUIState.showOnlyConnected),e=o}return e}},{key:"connectedUsers",get:function(){var t,e=new Map;return this.ipGroups.forEach((function(n){return n.connectedUsers.forEach((function(n){return e.set(n,(null!==(t=e.get(n))&&void 0!==t?t:0)+1)}))})),De(e.entries()).map((function(t){var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(t,e)||Be(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2);return{uid:e[0],count:e[1]}})).sort((function(t,e){var n=t.uid,r=t.count,o=e.uid;return e.count-r||n-o}))}},{key:"connect",value:function(){this.element.insertAdjacentElement("afterbegin",this.uiDiv),this.updateConnectedUsersList(this.connectedUsers),this.updateFocusedUsersList()}},{key:Je,value:function(t){t.setFrequencies(this.connectedUsers)}},{key:"reloadPreferences",value:function(){N(),this.refresh()}},{key:"showConnected",value:function(t){var e=t.detail.connCount;e!==this.threshold&&(this.threshold=e,this.refreshConnectedUsers(this.connectedUsers))}},{key:"toggleOnly",value:function(t){var e=t.target;H.xrefUIState.showOnlyConnected=e.checked,this.ipGroups.forEach((function(t){return t.refresh(e.checked)}))}},{key:"sectionToggled",value:function(t){var e=t.target,n=e.getAttribute("aria-controls");n&&Object.hasOwn(H.xrefUIState.openedSections,n)&&(H.xrefUIState.openedSections[n]="true"===e.getAttribute("aria-expanded"))}},{key:"addFocusUser",value:function(t){var e=t.params.uid,n=H.focusedUsers.length;H.focusedUsers=Array.from(new Set(De(H.focusedUsers).concat([e]))).sort((function(t,e){return t-e})),H.focusedUsers.length!==n&&this.refresh()}},{key:"removeFocusUser",value:function(t){var e=t.params.uid,n=H.focusedUsers.length;H.focusedUsers=H.focusedUsers.filter((function(t){return t!==e})),H.focusedUsers.length!==n&&this.refresh()}},{key:"clearFocusUsers",value:function(){confirm("Clear all focused users?")&&H.focusedUsers.length>0&&(H.focusedUsers=[],this.refresh())}},{key:"copyFocusUsers",value:function(t){var e=t.target,n=this,r=H.focusedUsers.map((function(t){var e=n.focusedUsersTarget.querySelector('a[href^="/users/'.concat(t,'/"]'));return e?e.href.replace(/.*\/users\//,""):t.toFixed(0)})).join("\n"),o=e.closest("button");navigator.clipboard.writeText(r).then((function(){return null==o||o.classList.add("is-copied"),new Promise((function(t){return setTimeout(t,1500)}))})).then((function(){return null==o?void 0:o.classList.remove("is-copied")}))}},{key:"updateFocusUsersGraphLink",value:function(t){var e=t.detail,n=luxon.DateTime.utc(),r=n.minus({days:14}),o=this.focusUsersGraphLinkTarget,a=new URL(o.href);a.hash="".concat(Ge(r),"|").concat(Ge(n),"|").concat(e.join(",")),o.href=a.toString()}},{key:"refresh",value:function(){var t=this;null!==this.refreshId&&window.cancelAnimationFrame(this.refreshId),this.refreshId=window.requestAnimationFrame((function(){t.threshold=0,t.updateFocusedUsersList();var e=t.connectedUsers;t.histogram.setFrequencies(e,!1),t.refreshConnectedUsers(e),t.refreshId=null}))}},{key:"refreshConnectedUsers",value:function(t){var e=this;this.ipGroups.forEach((function(n){return n.updateUsersBelowThreshold(e.threshold,t)})),this.updateConnectedUsersList(t)}},{key:"updateConnectedUsersList",value:function(e){var n=this,r=function(){var r=n.connectedUsersTarget;r.replaceChildren(),e.forEach((function(e){var o=e.uid,a=e.count;if(!(a<n.threshold)){var i="Overlaps on ".concat(a," IP").concat(1!==a?"s":"");r.insertAdjacentHTML("beforeend",'<div class="s-sidebarwidget--item ai-center"\n              data-uid="'.concat(o,'"\n              data-').concat(ae.controllerId,'-target="userRow"\n              data-user-card-keep-first="true"\n          >\n            <div class="s-user-card" data-uid="').concat(o,'">\n              <span class="s-user-card--time">').concat(i,'</span>\n              <span class="s-avatar s-avatar__32 s-user-card--avatar">\n                <span class="anonymous-gravatar s-avatar--image"></span>\n              </span>\n              <div class="s-user-card--info">user').concat(o,'</div>\n            </div>\n            <div class="s-user-actions ml-auto">\n              <button class="s-btn s-btn__icon s-btn__xs"\n                      data-controller="s-tooltip"\n                      data-action="').concat(t,'#addFocusUser"\n                      data-').concat(t,'-uid-param="').concat(o,'" \n                      title="Add this user to the focused accounts list"\n                >\n                  ').concat(s,'\n                  <span class="md:d-none">Focus</span>\n                </button>\n            </div>\n          </div>'))}}))};null===this.refreshId?window.requestAnimationFrame(r):r()}},{key:"updateFocusedUsersList",value:function(){var e=this.focusedUsersTarget;e.replaceChildren(),H.focusedUsers.forEach((function(n){e.insertAdjacentHTML("beforeend",'<div class="s-sidebarwidget--item"\n              data-uid="'.concat(n,'"\n              data-').concat(ae.controllerId,'-target="userRow"\n          >\n            <div class="s-user-card">\n              <span class="s-avatar s-avatar__32 s-user-card--avatar">\n                <span class="anonymous-gravatar s-avatar--image"></span>\n              </span>\n              <div class="s-user-card--info">user').concat(n,'</div>\n            </div>\n            <div class="s-user-actions ml-auto">\n              <button class="s-btn s-btn__icon s-btn__xs s-btn__danger"\n                      data-controller="s-tooltip"\n                      data-action="').concat(t,'#removeFocusUser"\n                      data-').concat(t,'-uid-param="').concat(n,'" \n                      title="Remove this user from the focused accounts list"\n                >').concat(i,'\n                  <span class="md:d-none">Remove</span>\n                </button>\n            </div>\n          </div>\n        </div>'))}))}}],a=[{key:"attach",value:function(t){var e=document.querySelector(t),n=Array.from(e.querySelectorAll(He)).filter((function(t){return null!==t.querySelector("tbody")}));Stacks.application.logDebugActivity(this.controllerId,"attach",{controllersToRegister:[this.controllerId,Pe.controllerId],hasXrefsTable:!!e,ipGroupsCount:n.length}),Stacks.application.register(Pe.controllerId,Pe),e.setAttribute(Stacks.application.schema.targetAttributeForScope(this.controllerId),"xrefsTable"),n.forEach((function(t){return t.dataset.controller=Pe.controllerId}));var r,o=e.parentElement,a=(null!==(r=o.dataset.controller)&&void 0!==r?r:"").split(" ");a.push(this.controllerId),o.dataset.controller=a.join(" ").trim(),o.setAttribute(Stacks.application.schema.outletAttributeForScope(this.controllerId,Pe.controllerId),He),o.setAttribute(Stacks.application.schema.outletAttributeForScope(this.controllerId,ge.controllerId),Ne),Stacks.application.register(this.controllerId,this)}},{key:"afterLoad",value:function(t,e){var n=[ge,T,ae];e.logDebugActivity(t,"afterLoad",{controllersToRegister:n.map((function(t){return t.controllerId}))});var r=!0,o=!1,a=void 0;try{for(var i,s=n[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;e.register(c.controllerId,c)}}catch(t){o=!0,a=t}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}document.head.insertAdjacentHTML("beforeend",'<style id="'.concat(t,'-styles">').concat(ze,"</style>"))}}],r&&Le(n.prototype,r),a&&Le(n,a),u}();Me(We,"controllerId",t),Me(We,"targets",["xrefsTable","connectedUsers","focusedUsers","focusUsersGraphLink"]),Me(We,"outlets",[ge.controllerId,Pe.controllerId]),new URL(location.href).searchParams.has("usModDebug")&&(Stacks.application.debug=!0),Stacks.application.logDebugActivity(t,"pre-flight",{isModerator:StackExchange.options.user.isModerator}),StackExchange.options.user.isModerator&&(Stacks.application.logDebugActivity(t,"xrefUsersView",{location:location.pathname}),location.pathname.includes("/admin/xref-user-ips/")&&Promise.all([r,(Ve="https://cdn.jsdelivr.net/npm/luxon@3/build/global/luxon.min.js",new Promise((function(t,e){if(null!==document.querySelector("script[src='".concat(Ve,"']")))return t();var n=document.createElement("script");n.onload=function(){return t()},n.onerror=function(t){return e(t.error)},n.src=Ve,document.head.appendChild(n)})))]).then((function(){We.attach("#xref-ids")})))})();