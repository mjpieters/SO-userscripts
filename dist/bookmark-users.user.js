// ==UserScript==
// @name        Bookmark Users
// @description Shows what user bookmarked a question. Fetches the bookmarking users from the StackExchange data explorer (data can be up to a week old)
// @version     1.5.2
// @author      Martijn Pieters
// @homepage    https://github.com/mjpieters/SO-userscripts/tree/main/scripts/bookmark-users
// @supportURL  https://github.com/mjpieters/SO-userscripts/issues?q=is:issue+is%3Aopen+label:bookmark-users
// @match       http*://*.stackoverflow.com/questions/*
// @match       http*://*.serverfault.com/questions/*
// @match       http*://*.superuser.com/questions/*
// @match       http*://*.askubuntu.com/questions/*
// @match       http*://*.mathoverflow.net/questions/*
// @match       http*://*.stackexchange.com/questions/*
// @connect     data.stackexchange.com
// @downloadURL https://github.com/mjpieters/SO-userscripts/releases/latest/download/bookmark-users.user.js
// @grant       GM_xmlhttpRequest
// @grant       GM_addStyle
// @namespace   https://github.com/mjpieters/SO-userscripts
// @updateURL   https://github.com/mjpieters/SO-userscripts/releases/latest/download/bookmark-users.meta.js
// ==/UserScript==

(()=>{"use strict";var t="9VvY5KWke5mKcflYkx)NDw((",e="https://api.stackexchange.com/2.3",n="us-bookmarkers",r="\n.".concat(n,"-content { min-height: min-content; }\n.").concat(n,"-popover .s-user-card__minimal .anonymous-gravatar {\n  zoom:0.5;\n  -moz-transform:scale(0.5);\n  -moz-transform-origin: 0 0;\n}\n.").concat(n,"-popover .s-user-card__minimal .s-user-card--time {\n  font-variant-numeric: tabular-nums;\n}\n");function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function a(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var c=function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function u(){return location.hostname.replace(/(\.stackexchange)?\.com$/,"")}var s=new Map;function l(t){return f.apply(this,arguments)}function f(){var n;return n=function(n){var r,a,l,f,p,d,y,h,v,b,m=arguments;return c(this,(function(c){switch(c.label){case 0:for(r=m.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=m[l];return k=1,f=function(t){if(Array.isArray(t))return t}(_=a)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(_,k)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(t,e):void 0}}(_,k)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),p=f[0],(d=new URL("".concat(e,"/").concat(n))).search=new URLSearchParams((w=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){i(t,e,n[e])}))}return t}({},p&&{filter:p}),g={key:t,site:u(),pagesize:"100"},g=null!=g?g:{},Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(g)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n.push.apply(n,r)}return n}(Object(g)).forEach((function(t){Object.defineProperty(w,t,Object.getOwnPropertyDescriptor(g,t))})),w)).toString(),(h=(null!==(y=s.get(n))&&void 0!==y?y:0)-(new Date).getTime())>0?[4,(S=h,new Promise((function(t){return setTimeout(t,S)})))]:[3,2];case 1:c.sent(),c.label=2;case 2:return[4,fetch(d.toString())];case 3:return[4,c.sent().json()];case 4:if(v=c.sent(),s.set(n,(new Date).getTime()+(null!==(b=v.backoff)&&void 0!==b?b:0)),v.error_id)throw new Error("".concat(v.error_name," (").concat(v.error_id,"): ").concat(v.error_message));return[2,v.items]}var w,g,_,k,S}))},f=function(){var t=this,e=arguments;return new Promise((function(r,o){var i=n.apply(t,e);function c(t){a(i,r,o,c,u,"next",t)}function u(t){a(i,r,o,c,u,"throw",t)}c(void 0)}))},f.apply(this,arguments)}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function d(t){var e=u();return new Promise((function(n,r){GM_xmlhttpRequest({method:"GET",url:"".concat("https://data.stackexchange.com/","/").concat(e,"/csv/").concat("1894927","?postId=").concat(t),fetch:!0,onload:function(t){200!==t.status&&r(new Error("invalid response ".concat(t)));var e=t.responseText.split(/\r?\n/).filter(Boolean);e.shift(),n(e.map((function(t){var e,n,r=(e=t.replaceAll('"',"").split(","),n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];return{date:o.split(" ")[0],userId:a}})))}})}))}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function h(t){var e,n;function r(e,n){try{var a=t[e](n),i=a.value,c=i instanceof g;Promise.resolve(c?i.wrapped:i).then((function(t){c?r("next",t):o(a.done?"return":"normal",t)}),(function(t){r("throw",t)}))}catch(t){o("throw",t)}}function o(t,o){switch(t){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):n=null}this._invoke=function(t,o){return new Promise((function(a,i){var c={key:t,arg:o,resolve:a,reject:i,next:null};n?n=n.next=c:(e=n=c,r(t,o))}))},"function"!=typeof t.return&&(this.return=void 0)}function v(t,e){var n={},r=!1;function o(n,o){return r=!0,o=new Promise((function(e){e(t[n](o))})),{done:!1,value:e(o)}}return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(t){return r?(r=!1,t):o("next",t)},"function"==typeof t.throw&&(n.throw=function(t){if(r)throw r=!1,t;return o("throw",t)}),"function"==typeof t.return&&(n.return=function(t){return o("return",t)}),n}function b(t){var e,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(r&&null!=(e=t[r]))return new m(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function m(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return m=function(t){this.s=t,this.n=t.next},m.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new m(t)}function w(t){return new g(t)}function g(t){this.wrapped=t}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function S(t,e,n){return e&&k(t.prototype,e),n&&k(t,n),t}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O(t){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},O(t)}function x(t,e){return x=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},x(t,e)}function P(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=O(t);if(e){var c=O(this).constructor;n=Reflect.construct(i,arguments,c)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r):o}}"function"==typeof Symbol&&Symbol.asyncIterator&&(h.prototype[Symbol.asyncIterator]=function(){return this}),h.prototype.next=function(t){return this._invoke("next",t)},h.prototype.throw=function(t){return this._invoke("throw",t)},h.prototype.return=function(t){return this._invoke("return",t)};var E=function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},A=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},T=new Intl.NumberFormat("en-US",{notation:"compact",maximumSignificantDigits:3}),I=new Intl.NumberFormat("en-US",{useGrouping:!0}),M=function(){function t(){_(this,t),j(this,"user_id",void 0),j(this,"display_name",void 0),j(this,"link",void 0),j(this,"profile_image",void 0),j(this,"reputation",void 0),j(this,"is_employee",void 0),j(this,"user_type",void 0)}return S(t,[{key:"badges",get:function(){var t=[];switch(this.is_employee&&t.push('<span class="s-badge s-badge__staff s-badge__xs">Staff</span>'),this.user_type){case"moderator":t.push('<span class="s-badge s-badge__moderator s-badge__xs">Mod</span>');break;case"team_admin":t.push('<span class="s-badge s-badge__admin s-badge__xs">Admin</span>')}return t.join(" ")}},{key:"abbreviated_reputation",get:function(){return this.reputation<1e4?I.format(this.reputation):T.format(this.reputation).toLowerCase()}},{key:"toHTML",value:function(t){return'\n      <div class="s-user-card s-user-card__minimal">\n        <time class="s-user-card--time">'.concat(t,'</time>\n        <a href="').concat(this.link,'" class="s-avatar s-user-card--avatar">\n          <img class="s-avatar--image" src="').concat(this.profile_image,'" />\n        </a>\n        <div class="s-user-card--info">\n          <a href="').concat(this.link,'" class="s-user-card--link"\n            >').concat(this.display_name," ").concat(this.badges,'</a\n          >\n          <ul class="s-user-card--awards">\n            <li\n              class="s-user-card--rep"\n              title="reputation score ').concat(I.format(this.reputation),'"\n            >\n              ').concat(this.abbreviated_reputation,"\n            </li>\n          </ul>\n        </div>\n      </div>\n    ")}}]),t}(),R=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&x(t,e)}(n,t);var e=P(n);function n(t){var r;return _(this,n),(r=e.call(this)).user_id=parseInt(t),r.link="/users/".concat(t),r}return S(n,[{key:"toHTML",value:function(t){return StackExchange.options.user.isModerator?'\n        <div class="s-user-card s-user-card__minimal s-user-card__deleted">\n          <time class="s-user-card--time">'.concat(t,'</time>\n          <a href="').concat(this.link,'" class="s-avatar s-user-card--avatar">\n            <span class="anonymous-gravatar"></span>\n          </a>\n          <div class="s-user-card--info">\n            <a href="').concat(this.link,'" class="s-user-card--link"\n              >user').concat(this.user_id,"</a\n            >\n          </div>\n        </div>\n      "):'\n      <div class="s-user-card s-user-card__minimal s-user-card__deleted">\n        <time class="s-user-card--time">'.concat(t,'</time>\n        <div class="s-avatar s-user-card--avatar">\n          <span class="anonymous-gravatar"></span>\n        </a>\n        <div class="s-user-card--info">\n          <div class="s-user-card--link">user').concat(this.user_id,"</a>\n        </div>\n      </div>\n    ")}}]),n}(M);function L(){var t;return t=function(t){var e,n,r=arguments;return E(this,(function(o){switch(o.label){case 0:e=function(){var e,r,o;return E(this,(function(a){switch(a.label){case 0:return e=t.splice(0,100),t=t.splice(100),[4,w(l("users/".concat(e.join(";")),"!)69QNaSIc2a*QW(ccD0ph0dVbliY"))];case 1:return r=a.sent(),o=new Map(r.map((function(t){return[t.user_id.toFixed(0),Object.assign(new M,t)]}))),[5,A(v(b(e.reduce((function(t,e){var r,a=o.get(e);return void 0===a&&n&&(a=new R(e)),a?(r=t,function(t){if(Array.isArray(t))return y(t)}(r)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(r)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).concat([a]):t}),[])),w))];case 2:return a.sent(),[2]}}))},n=r.length>1&&void 0!==r[1]&&r[1],o.label=1;case 1:return t.length>0?[5,A(e())]:[3,3];case 2:return o.sent(),[3,1];case 3:return[2]}}))},L=function(){return new h(t.apply(this,arguments))},L.apply(this,arguments)}function D(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function B(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return B=function(t){this.s=t,this.n=t.next},B.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new B(t)}function q(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function C(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function G(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},U(t)}function H(t,e){return H=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},H(t,e)}function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r,o,a,i=U(t);if(e){var c=U(this).constructor;n=Reflect.construct(i,arguments,c)}else n=i.apply(this,arguments);return r=this,!(o=n)||"object"!=((a=o)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof o?D(r):o}}var z='\n  <button\n    class="s-btn s-btn__unset c-pointer py4"\n    data-controller="s-tooltip '.concat(n,'"\n    data-s-popover-toggle-class="fc-yellow-600"\n    data-s-tooltip-placement="right"\n    data-action="click->s-popover#toggle s-popover:show->').concat(n,'#showBookmarkers"\n    aria-pressed="false"\n    title="Show who bookmarked this question."\n  ></button>\n'),F='\n  <div\n    class="'.concat(n,'-popover s-popover"\n    role="dialog"\n    aria-hidden="true"\n  >\n    <div class="s-popover--arrow"></div>\n    <div class="m4 hmx3 wmx100 overflow-x-hidden overflow-y-auto">\n      <div\n        class="').concat(n,'-popover-inner d-flex fd-column flex__center gs8 gsy"\n      >\n        <ul class="list-reset flex--item mr-auto"></ul>\n        <div class="s-spinner s-spinner__sm flex--item">\n          <div class="v-visible-sr">Loading…</div>\n        </div>\n      </div>\n    </div>\n  </div>\n'),$=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&H(t,e)}(c,Stacks.StacksController);var e,o,a,i=N(c);function c(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),G(D(t=i.apply(this,arguments)),"state","initial"),G(D(t),"popoverElement",void 0),t}return e=c,o=[{key:"connect",value:function(){var t;"initial"===this.state&&(this.state="attached",Stacks.attachPopover(this.element,F),this.popoverElement=document.getElementById(null!==(t=this.element.getAttribute("aria-controls"))&&void 0!==t?t:""))}},{key:"showBookmarkers",value:function(){var t,e=this;return(t=function(){var t,n,r,o,a,i,c,u,s,l,f,p,y,h,v;return function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(b){switch(b.label){case 0:return"attached"!==e.state?[2]:(e.state="loading",o=null===(t=e.popoverElement)||void 0===t?void 0:t.querySelector("ul"),[4,d(StackExchange.question.getQuestionId())]);case 1:return(a=b.sent()).length?[3,2]:(null==o||o.insertAdjacentHTML("beforeend",'<li class="mb4 fs-italic">No bookmarkers known (yet)</li>'),null==o||o.classList.add("mx-auto"),[3,14]);case 2:i=new Map(a.map((function(t){return[t.userId,t.date]}))),c=!1,u=!1,b.label=3;case 3:b.trys.push([3,8,9,14]),l=function(t){var e,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(r&&null!=(e=t[r]))return new B(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}(function(t){return L.apply(this,arguments)}(a.map((function(t){return t.userId})),!0)),b.label=4;case 4:return[4,l.next()];case 5:if(!(c=!(f=b.sent()).done))return[3,7];p=f.value,y=p,null==o||o.insertAdjacentHTML("beforeend",'<li class="mb4">'.concat(y.toHTML(null!==(h=i.get(y.user_id.toFixed(0)))&&void 0!==h?h:"&lt;unknown&gt;"),"</li>")),b.label=6;case 6:return c=!1,[3,4];case 7:return[3,14];case 8:return v=b.sent(),u=!0,s=v,[3,14];case 9:return b.trys.push([9,,12,13]),c&&null!=l.return?[4,l.return()]:[3,11];case 10:b.sent(),b.label=11;case 11:return[3,13];case 12:if(u)throw s;return[7];case 13:return[7];case 14:return e.state="loaded",null===(n=null===(r=e.popoverElement)||void 0===r?void 0:r.querySelector(".s-spinner"))||void 0===n||n.remove(),[2]}}))},function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){q(a,r,o,i,c,"next",t)}function c(t){q(a,r,o,i,c,"throw",t)}i(void 0)}))})()}}],a=[{key:"attach",value:function(t){var e,o;t&&(null===(e=t.querySelector(".js-bookmark-count"))||void 0===e?void 0:e.offsetParent)&&(c.style||(c.style=GM_addStyle(r)),t.insertAdjacentHTML("afterend",z),null===(o=t.nextElementSibling)||void 0===o||o.insertAdjacentElement("beforeend",Svg.Person()[0]),Stacks.application.register(n,c))}}],o&&C(e.prototype,o),a&&C(e,a),c}();G($,"style",void 0),StackExchange.ready((function(){return $.attach(document.querySelector(".js-bookmark-btn"))}))})();