// ==UserScript==
// @name        Bookmark Users
// @description Shows what user bookmarked a question. Fetches the bookmarking users from the StackExchange data explorer (data can be up to a week old)
// @version     1.4.8
// @author      Martijn Pieters
// @homepage    https://github.com/mjpieters/SO-userscripts/tree/main/scripts/bookmark-users
// @supportURL  https://github.com/mjpieters/SO-userscripts/issues?q=is:issue+is%3Aopen+label:bookmark-users
// @match       http*://*.stackoverflow.com/questions/*
// @match       http*://*.serverfault.com/questions/*
// @match       http*://*.superuser.com/questions/*
// @match       http*://*.askubuntu.com/questions/*
// @match       http*://*.mathoverflow.net/questions/*
// @match       http*://*.stackexchange.com/questions/*
// @connect     data.stackexchange.com
// @downloadURL https://github.com/mjpieters/SO-userscripts/raw/main/dist/bookmark-users.user.js
// @grant       GM_xmlhttpRequest
// @grant       GM_addStyle
// @namespace   https://github.com/mjpieters/SO-userscripts
// @updateURL   https://github.com/mjpieters/SO-userscripts/raw/main/dist/bookmark-users.meta.js
// ==/UserScript==

(()=>{"use strict";var t="9VvY5KWke5mKcflYkx)NDw((",e="https://api.stackexchange.com/2.3",n="!)69QNaSIc2a*QW(ccD0ph0dVbliY",r="us-bookmarkers",o="\n.".concat(r,"-content { min-height: min-content; }\n.").concat(r,"-popover .s-user-card__minimal .anonymous-gravatar {\n  zoom:0.5;\n  -moz-transform:scale(0.5);\n  -moz-transform-origin: 0 0;\n}\n.").concat(r,"-popover .s-user-card__minimal .s-user-card--time {\n  font-variant-numeric: tabular-nums;\n}\n");function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function i(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function c(t){i(a,r,o,c,u,"next",t)}function u(t){i(a,r,o,c,u,"throw",t)}c(void 0)}))}}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){u(t,e,n[e])}))}return t}function l(t,e){return e=null!=e?e:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):function(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n.push.apply(n,r)}return n}(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var p=function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function d(){return location.hostname.replace(/(\.stackexchange)?\.com$/,"")}function y(t){return new Promise((function(e){return setTimeout(e,t)}))}var h=new Map;function v(t){return b.apply(this,arguments)}function b(){return b=c((function(n){var r,o,a,i,c,u,v,b,m,w,g=arguments;return p(this,(function(p){switch(p.label){case 0:for(r=g.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=g[a];return i=f(o,1),c=i[0],(u=new URL("".concat(e,"/").concat(n))).search=new URLSearchParams(l(s({},c&&{filter:c}),{key:t,site:d(),pagesize:"100"})).toString(),(b=(null!==(v=h.get(n))&&void 0!==v?v:0)-(new Date).getTime())>0?[4,y(b)]:[3,2];case 1:p.sent(),p.label=2;case 2:return[4,fetch(u.toString())];case 3:return[4,p.sent().json()];case 4:if(m=p.sent(),h.set(n,(new Date).getTime()+(null!==(w=m.backoff)&&void 0!==w?w:0)),m.error_id)throw new Error("".concat(m.error_name," (").concat(m.error_id,"): ").concat(m.error_message));return[2,m.items]}}))})),b.apply(this,arguments)}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function w(t){var e=d();return new Promise((function(n,r){GM_xmlhttpRequest({method:"GET",url:"".concat("https://data.stackexchange.com/","/").concat(e,"/csv/").concat("1894927","?postId=").concat(t),fetch:!0,onload:function(t){200!==t.status&&r(new Error("invalid response ".concat(t)));var e=t.responseText.split(/\r?\n/).filter(Boolean);e.shift(),n(e.map((function(t){var e,n,r=(e=t.replaceAll('"',"").split(","),n=2,function(t){if(Array.isArray(t))return t}(e)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(t);!(i=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);i=!0);}catch(t){c=!0,o=t}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],a=r[1];return{date:o.split(" ")[0],userId:a}})))}})}))}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _(t){var e,n;function r(e,n){try{var a=t[e](n),i=a.value,c=i instanceof x;Promise.resolve(c?i.wrapped:i).then((function(t){c?r("next",t):o(a.done?"return":"normal",t)}),(function(t){r("throw",t)}))}catch(t){o("throw",t)}}function o(t,o){switch(t){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):n=null}this._invoke=function(t,o){return new Promise((function(a,i){var c={key:t,arg:o,resolve:a,reject:i,next:null};n?n=n.next=c:(e=n=c,r(t,o))}))},"function"!=typeof t.return&&(this.return=void 0)}function k(t,e){var n={},r=!1;function o(n,o){return r=!0,o=new Promise((function(e){e(t[n](o))})),{done:!1,value:e(o)}}return"function"==typeof Symbol&&Symbol.iterator&&(n[Symbol.iterator]=function(){return this}),n.next=function(t){return r?(r=!1,t):o("next",t)},"function"==typeof t.throw&&(n.throw=function(t){if(r)throw r=!1,t;return o("throw",t)}),"function"==typeof t.return&&(n.return=function(t){return o("return",t)}),n}function S(t){var e,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(r&&null!=(e=t[r]))return new j(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function j(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return j=function(t){this.s=t,this.n=t.next},j.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new j(t)}function O(t){return new x(t)}function x(t){this.wrapped=t}function P(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function E(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function A(t,e,n){return e&&E(t.prototype,e),n&&E(t,n),t}function T(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function I(t){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},I(t)}function M(t,e){return!e||"object"!==D(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function R(t,e){return R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},R(t,e)}function L(t){return function(t){if(Array.isArray(t))return g(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return g(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}"function"==typeof Symbol&&Symbol.asyncIterator&&(_.prototype[Symbol.asyncIterator]=function(){return this}),_.prototype.next=function(t){return this._invoke("next",t)},_.prototype.throw=function(t){return this._invoke("throw",t)},_.prototype.return=function(t){return this._invoke("return",t)};var D=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function B(t){return function(){return new _(t.apply(this,arguments))}}var q=function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},C=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},G=new Intl.NumberFormat("en-US",{notation:"compact",maximumSignificantDigits:3}),U=new Intl.NumberFormat("en-US",{useGrouping:!0}),H=function(){function t(){P(this,t),T(this,"user_id",void 0),T(this,"display_name",void 0),T(this,"link",void 0),T(this,"profile_image",void 0),T(this,"reputation",void 0),T(this,"is_employee",void 0),T(this,"user_type",void 0)}return A(t,[{key:"badges",get:function(){var t=[];switch(this.is_employee&&t.push('<span class="s-badge s-badge__staff s-badge__xs">Staff</span>'),this.user_type){case"moderator":t.push('<span class="s-badge s-badge__moderator s-badge__xs">Mod</span>');break;case"team_admin":t.push('<span class="s-badge s-badge__admin s-badge__xs">Admin</span>')}return t.join(" ")}},{key:"abbreviated_reputation",get:function(){return this.reputation<1e4?U.format(this.reputation):G.format(this.reputation).toLowerCase()}},{key:"toHTML",value:function(t){return'\n      <div class="s-user-card s-user-card__minimal">\n        <time class="s-user-card--time">'.concat(t,'</time>\n        <a href="').concat(this.link,'" class="s-avatar s-user-card--avatar">\n          <img class="s-avatar--image" src="').concat(this.profile_image,'" />\n        </a>\n        <div class="s-user-card--info">\n          <a href="').concat(this.link,'" class="s-user-card--link"\n            >').concat(this.display_name," ").concat(this.badges,'</a\n          >\n          <ul class="s-user-card--awards">\n            <li\n              class="s-user-card--rep"\n              title="reputation score ').concat(U.format(this.reputation),'"\n            >\n              ').concat(this.abbreviated_reputation,"\n            </li>\n          </ul>\n        </div>\n      </div>\n    ")}}]),t}(),N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(o,t);var e,n,r=(e=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,r=I(e);if(n){var o=I(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return M(this,t)});function o(t){var e;return P(this,o),(e=r.call(this)).user_id=parseInt(t),e.link="/users/".concat(t),e}return A(o,[{key:"toHTML",value:function(t){return StackExchange.options.user.isModerator?'\n        <div class="s-user-card s-user-card__minimal s-user-card__deleted">\n          <time class="s-user-card--time">'.concat(t,'</time>\n          <a href="').concat(this.link,'" class="s-avatar s-user-card--avatar">\n            <span class="anonymous-gravatar"></span>\n          </a>\n          <div class="s-user-card--info">\n            <a href="').concat(this.link,'" class="s-user-card--link"\n              >user').concat(this.user_id,"</a\n            >\n          </div>\n        </div>\n      "):'\n      <div class="s-user-card s-user-card__minimal s-user-card__deleted">\n        <time class="s-user-card--time">'.concat(t,'</time>\n        <div class="s-avatar s-user-card--avatar">\n          <span class="anonymous-gravatar"></span>\n        </a>\n        <div class="s-user-card--info">\n          <div class="s-user-card--link">user').concat(this.user_id,"</a>\n        </div>\n      </div>\n    ")}}]),o}(H);function z(){return z=B((function(t){var e,r,o=arguments;return q(this,(function(a){switch(a.label){case 0:e=function(){var e,o,a;return q(this,(function(i){switch(i.label){case 0:return e=t.splice(0,100),t=t.splice(100),[4,O(v("users/".concat(e.join(";")),n))];case 1:return o=i.sent(),a=new Map(o.map((function(t){return[t.user_id.toFixed(0),Object.assign(new H,t)]}))),[5,C(k(S(e.reduce((function(t,e){var n=a.get(e);return void 0===n&&r&&(n=new N(e)),n?L(t).concat([n]):t}),[])),O))];case 2:return i.sent(),[2]}}))},r=o.length>1&&void 0!==o[1]&&o[1],a.label=1;case 1:return t.length>0?[5,C(e())]:[3,3];case 2:return a.sent(),[3,1];case 3:return[2]}}))})),z.apply(this,arguments)}function F(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function $(t){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var e=t.done;return Promise.resolve(t.value).then((function(t){return{value:t,done:e}}))}return $=function(t){this.s=t,this.n=t.next},$.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?Promise.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?Promise.reject(t):e(n.apply(this.s,arguments))}},new $(t)}function Q(t,e,n,r,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void n(t)}c.done?e(u):Promise.resolve(u).then(r,o)}function Y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function K(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function V(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function W(t){return W=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},W(t)}function J(t,e){return!e||"object"!==Z(e)&&"function"!=typeof e?F(t):e}function X(t,e){return X=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},X(t,e)}var Z=function(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};var tt='\n  <button\n    class="s-btn s-btn__unset c-pointer py4"\n    data-controller="s-tooltip '.concat(r,'"\n    data-s-popover-toggle-class="fc-yellow-600"\n    data-s-tooltip-placement="right"\n    data-action="click->s-popover#toggle s-popover:show->').concat(r,'#showBookmarkers"\n    aria-pressed="false"\n    title="Show who bookmarked this question."\n  ></button>\n'),et='\n  <div\n    class="'.concat(r,'-popover s-popover"\n    role="dialog"\n    aria-hidden="true"\n  >\n    <div class="s-popover--arrow"></div>\n    <div class="m4 hmx3 wmx100 overflow-x-hidden overflow-y-auto">\n      <div\n        class="').concat(r,'-popover-inner d-flex fd-column flex__center gs8 gsy"\n      >\n        <ul class="list-reset flex--item mr-auto"></ul>\n        <div class="s-spinner s-spinner__sm flex--item">\n          <div class="v-visible-sr">Loading…</div>\n        </div>\n      </div>\n    </div>\n  </div>\n'),nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&X(t,e)}(s,Stacks.StacksController);var e,n,a,i,c,u=(i=s,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=W(i);if(c){var n=W(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return J(this,t)});function s(){var t;return Y(this,s),V(F(t=u.apply(this,arguments)),"state","initial"),V(F(t),"popoverElement",void 0),t}return e=s,n=[{key:"connect",value:function(){var t;"initial"===this.state&&(this.state="attached",Stacks.attachPopover(this.element,et),this.popoverElement=document.getElementById(null!==(t=this.element.getAttribute("aria-controls"))&&void 0!==t?t:""))}},{key:"showBookmarkers",value:function(){var t,e=this;return(t=function(){var t,n,r,o,a,i,c,u,s,l,f,p,d,y,h;return function(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}(this,(function(v){switch(v.label){case 0:return"attached"!==e.state?[2]:(e.state="loading",o=null===(t=e.popoverElement)||void 0===t?void 0:t.querySelector("ul"),[4,w(StackExchange.question.getQuestionId())]);case 1:return(a=v.sent()).length?[3,2]:(null==o||o.insertAdjacentHTML("beforeend",'<li class="mb4 fs-italic">No bookmarkers known (yet)</li>'),null==o||o.classList.add("mx-auto"),[3,14]);case 2:i=new Map(a.map((function(t){return[t.userId,t.date]}))),c=!1,u=!1,v.label=3;case 3:v.trys.push([3,8,9,14]),l=function(t){var e,n,r,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);o--;){if(n&&null!=(e=t[n]))return e.call(t);if(r&&null!=(e=t[r]))return new $(e.call(t));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}(function(t){return z.apply(this,arguments)}(a.map((function(t){return t.userId})),!0)),v.label=4;case 4:return[4,l.next()];case 5:if(!(c=!(f=v.sent()).done))return[3,7];p=f.value,d=p,null==o||o.insertAdjacentHTML("beforeend",'<li class="mb4">'.concat(d.toHTML(null!==(y=i.get(d.user_id.toFixed(0)))&&void 0!==y?y:"&lt;unknown&gt;"),"</li>")),v.label=6;case 6:return c=!1,[3,4];case 7:return[3,14];case 8:return h=v.sent(),u=!0,s=h,[3,14];case 9:return v.trys.push([9,,12,13]),c&&null!=l.return?[4,l.return()]:[3,11];case 10:v.sent(),v.label=11;case 11:return[3,13];case 12:if(u)throw s;return[7];case 13:return[7];case 14:return e.state="loaded",null===(n=null===(r=e.popoverElement)||void 0===r?void 0:r.querySelector(".s-spinner"))||void 0===n||n.remove(),[2]}}))},function(){var e=this,n=arguments;return new Promise((function(r,o){var a=t.apply(e,n);function i(t){Q(a,r,o,i,c,"next",t)}function c(t){Q(a,r,o,i,c,"throw",t)}i(void 0)}))})()}}],a=[{key:"attach",value:function(t){var e,n;t&&(null===(e=t.querySelector(".js-bookmark-count"))||void 0===e?void 0:e.offsetParent)&&(s.style||(s.style=GM_addStyle(o)),t.insertAdjacentHTML("afterend",tt),null===(n=t.nextElementSibling)||void 0===n||n.insertAdjacentElement("beforeend",Svg.Person()[0]),Stacks.application.register(r,s))}}],n&&K(e.prototype,n),a&&K(e,a),s}();V(nt,"style",void 0),StackExchange.ready((function(){return nt.attach(document.querySelector(".js-bookmark-btn"))}))})();